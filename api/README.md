## Getting started

This is a basic API REST skeleton written on JavaScript using async/await. Great for building a starter web API for your front-end (Android, iOS, Vue, react, angular, or anything that can consume an API)

API + Frontend
Both projects can be used by developers.

## Features

*   Multiple environment ready (development, production)
*   Custom email/password user system with basic security and blocking for preventing brute force attacks.
*   Compressed responses.
*   Secured HTTP headers.
*   CORS ready.
*   Cache ready (Redis).
*   HTTP request logger in development mode.
*   i18n ready (for sending emails in multiple languages).
*   User roles.
*   Pagination ready.
*   User profile.
*   Users list for admin area.
*   Cities model and controller example.
*   Login access log with IP, browser and country location (for country it looks for the header `cf-ipcountry` that CloudFlare creates when protecting your website).
*   API autogenerated documentation by Postman.
*   API collection example for Postman.
*   Testing with mocha/chai for API endpoints.
*   NPM scripts for cleaning and seeding the MongoDB database.
*   NPM script for keeping good source code formatting using prettier and ESLint.
*   Use of ESLint for good coding practices.
*   Mailer example with Nodemailer and Mailgun.
*   Ability to refresh token
*   JWT Tokens, make requests with a token after login with `Authorization` header with value `Bearer yourToken` where `yourToken` is the **signed and encrypted token** given in the response from the login process.

## Requirements

*   Node.js **10+**
*   MongoDB **3.6+**
*   Redis **5.0+**

### Default Login credentials
email: `admin@admin.com`
password: `12345`

**IMPORTANT NOTE:**
Database resets every 30 mins like "12:00am, 12:30am, 1:00am" and so on. So anything you do with the API will be lost after a short time.
This we make only for testing. When You start project for Real Data-Bank App, then make sure take the copy of this project, and then in that new cloned copy, you remove all unnecessary scripts in package.json file. and only keep the scripts that You need. So that, when this package goes on live server for App, it should be cleaned with required scripts to access on live server.

## How to install


### Install npm dependencies after installing (Git or manual download)

`------ #CLI/BASH -----`
cd myproject
npm install
npm update
`-----------`

### Setting up environments (development or production)

1.  In the root this repository you will find a file named `.env.example`
2.  Create a new file by copying and pasting the file and then renaming it to just `.env`
3.  The file `.env` is already ignored, so you never commit your credentials.
4.  Change the values of the file to your environment (development or production)
5.  Upload the `.env` to your environment server(development or production)
6.  If you use the postman collection to try the endpoints, change value of the variable `server` on your environment to the url of your server, for development mode use <http://localhost:3000>

**IMPORTANT NOTE:**
By default token expires in 3 days (4320 minutes set in .env.example). You can refresh token at endpoint GET /token. If everything it´s ok you will get a new token.

### Mailer
To ensure the deliverability of emails sent by this API, `Mailtrap.io` for testing purpose, and `SendGrid` is used for mailing users on live server when they sign up. Check ENV file!

### i18n
Language is automatically detected from `Accept-Language` header on the request. So either you send locale manually on the request or your browser will send its default, if `Accept-Language` header is not sent then it will use `en` locale as default.

## How to run

### Database cleaning and seeding samples

There are 3 available commands for this: `fresh`, `clean` and `seed`.

`------- #CLI/BASH ----`
npm run `COMMAND-I-WANT`
`-----------`

*   `fresh` cleans and then seeds the database with dynamic data.
*   `clean` cleans the database.
*   `seed` seeds the database with dynamic data.

* for example;
`#user/myProject: npm run fresh`
`#user/myProject: npm run clean`
`#user/myProject: npm run seed`
If you see the package.json file for scripts
`fresh` command goes into script of package, and execute two commands; clean and seed
`clean` and `seed` command work separately from SCRIPTS of package.json on CLI


### Running in development mode (lifting API server)
`------ #CLI/BASH -----`
npm run dev
`-----------`
If you see the package.json file for scripts
`dev` binds `cross-env NODE_ENV=development nodemon --inspect=9230 server.js`
set the env variable to development, and starts the nodemon with inspection on the server file.
if you don't have nodemon (You can install for its advantages), then you will need to change `nodemon` to `node start server.js`, if you want it.


### Accessing the API Server with Mongo
You will know server is running by checking the output of the command `npm run dev`

`------ #CLI/BASH -----`
****************************
*    Starting Server
*    Port: 3000
*    NODE_ENV: development
*    Database: MongoDB
*    DB Connection: OK
****************************
`-----------`

### Running tests
It´s a good practice to do tests at your code, so a sample of how to do that in `mocha/chai` is also included in the `/test` directory

`------ #CLI/BASH -----`
npm run test
`-----------`

### Formatting code
Format your code with prettier by typing:

`------ #CLI/BASH -----`
npm run format
`-----------`

### Formatting markdown files

Format all your markdown files with remark by typing:

`----- #CLIBASH ------`
npm run remark
`-----------`

### Linting code
Lint your code with ESLint by typing:

`------ #CLI/BASH -----`
npm run lint
`-----------`

## Usage
Once everything is set up to test API routes either use Postman or any other api testing application. Default username/password combination for login is `admin@admin.com/12345`.

### Postman API example collection
You can import the example collection to Postman. To import, click the import button located and select `postman-example.json` located within the root directory.

Go to `manage environments` to create environments for development, production, etc. On each of the environments you create you will need to:

1.  Create a new key `authToken` and within the `/login` request this value is automatically updated after a successfull login through a script located in the `tests` tab. Each time you make a request to the API it will send `Authorization` header with the `token` value in the request, you can check this on the headers of users or cities endpoints in the Postman example.

2.  Create a second key `server` with the url of your server, for development mode use <http://localhost:3000>

This is a REST API, so it works using the following HTTP methods:

*   GET (Read): Gets a list of items, or a single item
*   POST (Create): Creates an item
*   PATCH (Update): Updates an item
*   DELETE: Deletes an item

### Creating new models
If you need to add more models to the project just create a new file in `/app/models/` and it will be loaded dynamically.

### Creating new routes
If you need to add more routes to the project just create a new file in `/app/routes/` and it will be loaded dynamically.

### Creating new controllers
When you create a new controller, try to also create another folder with validations and helpers. Ex. `/countries`, `/countries/validators` and `/countries/helpers`. An example of this is included in the repository.
